<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Unit tests</title>

		<meta name="description" content="Women Who Code technical interview preparation: unit tests">
		<meta name="author" content="Elze Hamilton">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/3.0.0/css/reveal.min.css">
		<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/3.0.0/css/theme/sky.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/3.0.0/lib/css/zenburn.css">

		<link rel="stylesheet" href="../common/css/style.css">

		<!--[if lt IE 9]>
		<script src="//cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<p class="presentation-header"><small>Unit testing | <a href="http://geekitude.com">Elze Hamilton</a> / <a href="http://twitter.com/elze">@elze</a> | Women Who Code tech interview preparation</small></p>
			<p class="presentation-header" style="text-align: center; font-size: 10px">Press Esc to see thumbnails of all slides.</p>
			<!-- Any section element inside of this container is displayed as a slide -->

			<div class="slides">			
				<section>
					<h2>Unit testing</h2>
					<p>
						<small>By <a href="http://geekitude.com">Elze Hamilton</a> / <a href="http://twitter.com/elze">@elze</a></small>
					</p>
					<p>
						<small>Women Who Code technical interview preparation series</small>
					</p>
				</section>

				<section><!-- slide 2 -->
					<h3>Basic things to know about unit testing</h3>
					<p class="alterconf">Unit tests are automated. They are code.</p>
					<p class="alterconf">Each unit test (ideally) tests one method of one class: thus, "unit".</p>
					<p class="alterconf">Here is an example of a unit test for a very simple method.</p>					
<pre><code class="presentation">
public List<int> doubleListElements() {
	var origList = new List<int>([1, 2, 3]);
	List<int> listOfDoubles = new List<int>();
	foreach (int elem in origList) 
		listOfDoubles.Add(elem * 2);
	return listOfDoubles;
}
</code></pre>

<pre><code class="presentation">
public doubleListElements_should_return_a_list_of_doubled_values() {
	var doubledList = doubleListElements(); 
	Assert.IsEqual(2, doubledList[0]);
	Assert.IsEqual(4, doubledList[1]);
	Assert.IsEqual(6, doubledList[2]);
}
</code></pre>
				</section>

				<section><!-- slide 3 -->
					<h4 class="alterconf-left">Important things to know about unit tests:</h4>
					<p class="alterconf">Unit tests are supposed to test just the application code.</b></p>
					<p class="alterconf">That means they need to be completely self-contained, i.e. independent from other resources, such as databases or the network.</p>
					<p class="alterconf">A unit test of server-side code should not call the database or third-party API.</p>
					<p class="alterconf">A unit test of frontend code should not call the database, third-party API, or server-side code.</p>

<img class="img-left-no-shadow" src="img/codeArchitecture_20160919.png"/>

<img class="img-right-no-shadow" src="img/codeArchitecture_UnitTests_20160920.png"/>

				</section>

				<section><!-- slide 4 -->
					<h4 class="alterconf-left">Then how do you test the code that <i>does</i> use external resources?</h4>
					<p class="alterconf">You mock, stub, or fake the external resources.</p>
					<p class="alterconf">For that you use classes called <i>mocks</i>, <i>stubs</i>, or <i>fakes</i>.</p>
					<p class="alterconf">Some people think those terms signify different things, some think they are interchangeable.</p>
					<p class="alterconf">Those classes are usually generated by mock / fake / stub frameworks, but they can be written by hand.</p>										
					<p class="alterconf">Their essence is this: the mock / fake / stub class has the same methods as the external resource class, but it returns hard-coded data.</p>		
				</section>

				<section><!-- slide 5 -->
					<h4 class="alterconf-left">Simple example: hand-written stub class and how to use it</h4>
					<p class="alterconf">Here is the method under test. It is similar to the previous example, except that this one depends on an external resource, <code>repository</code>.</p>			
<pre><code class="presentation">
public List<int> doubleListElements(IRepository repository) {
	var origList = repository.GetList();
	List<int> listOfDoubles = new List<int>();
	foreach (int elem in origList) 
		listOfDoubles.Add(elem * 2);
	return listOfDoubles;
}
</code></pre>
					<p class="alterconf">Note that the <code>IRepository</code> type starts with I. In C#, this notation means it is an interface. They play a role in unit testing that we will see soon.</p>
					<p class="alterconf">Java and PHP have interfaces too. Many other languages don't have them, but that's not really important. What is important is that they have inheritance, because it plays a big part in creating mocks, stubs, and fakes.</p>
					</section>

				<section><!-- slide 6 -->
					<h4 class="alterconf">Back to the example</h4>
					<p class="alterconf">The <code>IRepository</code> is a wrapper for the database (thus, "repository"). A database is an external resource. We can't use them in unit tests, so we need to mock / fake / stub the <code>IRepository</code> </p>
<pre><code class="presentation">
// The application code
interface IRepository {
	List<int> GetList();
}
public List<int> doubleListElements(IRepository repository) {
	var origList = repository.GetList();
	List<int> listOfDoubles = new List<int>();
	foreach (int elem in origList) 
		listOfDoubles.Add(elem * 2);
	return listOfDoubles;
}
// The mock / stub / fake FakeRepository class implements IRepository interface
class FakeRepository: IRepository {
	public List<int> GetList() {
		return [3, 5, 8];
	];
}
</code></pre>
				</section>

				<section><!-- slide 7 -->
					<h4 class="alterconf">Back to the unit test</h4>
					<p class="alterconf">Here is the previous unit test, rewritten with a <code>IRepository</code> fake.</p>
<pre><code class="presentation">
public doubleListElements_should_return_a_list_of_doubled_values(IRepository repository) {
	var doubledList = doubleListElements(repository); 
	Assert.IsEqual(6, doubledList[0]);
	Assert.IsEqual(10, doubledList[1]);
	Assert.IsEqual(16, doubledList[2]);
}
</code></pre>
					<p class="alterconf">And this is how we call this test:</p>
<pre><code class="presentation">
IRepository repository = new FakeRepository();
// doubleListElements() will call repository.GetList(),
// which in this case will be FakeRepository.GetList()
// The FakeRepository.GetList() will return the hardcoded list [3, 5, 8]
doubleListElements_should_return_a_list_of_doubled_values(repository);
</code></pre>
</section>
				<section><!-- slide 8 -->
					<h3>Important question</h3>
					<p class="sixty-percent-left">Can you name the principle or principles that allowed to substitute <code>FakeRepository</code> for <code>IRepository</code> ? </p>
					<p class="sixty-percent-left fragment">Dependency injection. </p>
				</section>
				<section><!-- slide 9 -->
					<h4 class="alterconf">Simple explanation of dependency injection</h4>

					<p class="alterconf"><code>IRepository</code> object is a dependency: the <code>doubleListElements()</code> depends on it. It is being <i>injected</i>, i.e. passed as an argument, to the <code>doubleListElements()</code> method.</p>
					<p class="alterconf">If it were not passed, the <code>doubleListElements()</code> method would need to create it on its own: </p>
<pre><code class="presentation">
public List<int> doubleListElements() {
	IRepository repository = new Repository(connectionString);
	var origList = repository.GetList();
	List<int> listOfDoubles = new List<int>();
	foreach (int elem in origList) 
		listOfDoubles.Add(elem * 2);
	return listOfDoubles;
}
</code></pre>
					<p class="alterconf">Thus, <code>doubleListElements()</code> would need to know how to create an <code>IRepository</code> object. In that case, the <code>IRepository</code> object would be "hardcoded" in the method, and we could not substitute a fake <code>IRepository</code> object for it. </p>

				</section>

				<section><!-- slide 10 -->
					<h4>Dependency injection for languages without interfaces</h4>
					<p class="alterconf">Some programming languages don't have interfaces, but have abstract classes, e.g. Python.</p>
					<p class="alterconf">Ruby has neither interfaces nor abstract classes, but dependency injection in it is still possible. You will just need to find out how to do it for yourself, if Ruby is your language of choice.</p>
					<p class="alterconf">Javascript does not have classes or object-based inheritance at all, but you can still do dependency injection in it. The important thing is to inject an object that has the same method as the "real" object that encapsulates external dependency. </p>

<img class="img-left-no-shadow" src="img/interfaceRepository_20161006_480.png"/>

<img class="img-right-no-shadow" src="img/interfaceRepository_20161006_480.png"/>

				</section>

				<section><!-- slide 11 -->
					<h4>Exercise: Let's make something unit-testable</h4>
					<p class="alterconf">Let's say there is this method that calls a third party service: </p>
<pre><code class="presentation">
public List<User> createUsers() {
	WebRequest httpRequest = WebRequest.Create("http://foo.com/users");
	var response = httpRequest.GetReponse();
	Stream responseStream = response.GetResponseStream();	
	List<User> users = new List<User>();
	
    	using(StreamReader reader = new StreamReader(responseStream)) {
        	while((string line = reader.ReadLine()) != null) {
            		User user = new User(line);
            		users.Add(user);
        	}
        	reader.Close();
    	}	
	return users;
}
</code></pre>
				</section>
				
				<section><!-- slide 12 -->
					<h4>Another, simpler version, more like pseudocode</h4>

<pre><code class="presentation">
public List<User> createUsers() {
	WebRequest httpRequest = WebRequest.Create("http://foo.com/users");
	var response = httpRequest.GetReponse();
	Stream responseStream = response.GetResponseStream();	
	List<User> users = new List<User>();
	
    	string[] responseLines = response.ReadLines();
        foreach (string line in responseLines) {
            		User user = new User(line);
            		users.Add(user);
    	}	
	return users;
}
</code></pre>
				</section>

				<section><!-- slide 13 -->
					<h4  class="alterconf">One possible solution</h4>

<pre><code class="presentation">
public List<User> createUsers(string[] responseLines) {
	List<User> users = new List<User>();
        foreach (string line in responseLines) {
            		User user = new User(line);
            		users.Add(user);
    	}	
	return users;
}
</code></pre>
<p class="alterconf">In the code that calls <code>createUsers</code>: </p>
<pre><code class="presentation">
	WebRequest httpRequest = WebRequest.Create("http://foo.com/users");
	var response = httpRequest.GetReponse();
	Stream responseStream = response.GetResponseStream();	
	List<User> users = createUsers(responseStream.ReadLines());
</code></pre>
<p class="alterconf">So as you see, you created a <code>responseStream</code> object outside of the <code>createUsers</code> method, and injected the array of strings that it returns into the <code>createUsers</code> method. </p>
<p class="alterconf">You may point out the the first 3 lines before the call to <code>responseStream</code> are not unit-testable, and that would be correct. Not everything is unit-testable. But those three lines are pretty much out of the can. </p>
				</section>

				<section><!-- slide 14 -->
					<h4>Mocks, fakes, and stubs</h4>
<p class="alterconf">Most of the time, however, we don't need to create these "fake" objects by hand. </p>
<p class="alterconf">For that, we use various mock frameworks. There are many of them, and usually they are specific to the programming language you use. </p>
					<ul>
						<li class="alterconf">Javascript: <b>Jasmine</b>, <b>ngMock</b> for Angular.js</li>
						<li class="alterconf">C#: <b>FakeItEasy</b> </li>
					</ul>
<p class="alterconf">... and many others. </p>
<p class="alterconf">NEED an example of how they are used. Maybe show how a method is spied on / how a method call is faked? </p>
			</section>
			<section><!-- slide 15 -->
				<h4>Mocks, fakes, and stubs in Javascript</h4>
<p class="alterconf">NEED an example of to unit-test a method and check if the methods it calls were called </p>

			</section>
			<section><!-- slide 16 -->
				<h4>Other important considerations for unit testability</h4>
<p class="alterconf">The fewer side effects a method has, the easier it is to unit-test. </p>
<p class="alterconf">Why? </p>
<p class="alterconf">If your method performs lots of calculations that have intermediate state -- lots of local variables -- your unit test can't "look" into that state and check if those calculations are being performed correctly. The intermediate state is fleeting. Spies can check whether some function was called, but they can't check if some complex loop-within-a-loop or multiple nested if-then-else statements are executed correctly.  </p>
<p class="alterconf">What to do? Try as much as possible to put that complex logic -- loops, if-then-else statements, etc. -- into their own methods. Make those methods return the value of the intermediate computation. </p>
<p class="alterconf">Then you'll be able to write a unit test that tests the return value of that computation. </p>
			</section>

			<section><!-- slide 17 -->
				<h4>NEED example for the previous slide</h4>
<p class="alterconf">This ties in with the so-called SOLID principles, specifically, with the first S. </p>
<p class="alterconf">The first S stands for Single responsibility. </p>
<p class="alterconf">This means a class or a method should only do one thing. For example: </p> 
<ul>
  <li class="alterconf">only read from a file</li>
  <li class="alterconf">only parse lines </li>
  <li class="alterconf">only calculate interest </li>
					</ul>
<p class="alterconf">... as opposed to a method that does... what? Calculates the wire transfer fee AND transfers the money? </p> 
			</section>


			<section><!-- slide 18 -->
				<h4>A method tht does too much</h4>
<pre><code class="presentation">
public void transferMoney(double amountToTransfer, Account account1, Account account2) {
  double transferFee = 0;
  if (amount < 100)
    transferFee = 10;
  else if (amount < 500)
    transferFee = 15;
       else
    	transferFee = 20;
  account1.amount = account1.amount - amountToTransfer - transferFee;
  account2.amount = account2.amount + amountToTransfer;
}
</code></pre>
			</section>
			<section><!-- slide 12 -->
					<h3>THE END</h3>
					<p>&nbsp;</p>
					<p><a href="http://geekitude.com">Elze Hamilton</a> / <a href="http://twitter.com/elze">@elze</p>
			</section>

			</div>
		</div>

		<script src="http://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/head.min.js"></script>
		<script src="http://cdn.jsdelivr.net/reveal.js/3.0.0/js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: '//cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: '//cdn.jsdelivr.net/reveal.js/3.0.0/plugin/notes/notes.js', async: true }
				]
			});

		</script>

<script type="text/javascript">
sc_project=2721969;
sc_invisible=0;
sc_security="5cfe5782";
</script>

<script type="text/javascript"
src="http://www.statcounter.com/counter/counter.js"></script><noscript><div
class="statcounter"><a title="site stats"
href="http://www.statcounter.com/free-web-stats/"
target="_blank"><img class="statcounter"
src="http://c29.statcounter.com/2721969/0/5cfe5782/0/"
alt="free hit counter" ></a></div></noscript>
<!-- End of StatCounter Code -->
	</body>
</html>
